<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Android Demo</title>
    <link rel="stylesheet" type="text/css" href="css/style.css">
</head>
<body ng-app="myApp" ng-controller="myCtrl">
    <h1>Android Demo</h1>
    <p>{{app_name}}</p>
    <div class="one_day" ng-repeat="day in days">
        <div ng-repeat="evn in day.at(1)"></div>
    </div>
    <pre>{{events}}</pre>

    <script src="js/jquery-3.0.0.min.js"></script>
    <script src="js/angular.min.js"></script>
    <script src="js/event.js"></script>
<script>
    var KEYGUARD_SHOWN = 17;
    var KEYGUARD_HIDDEN = 18;
    var app = angular.module('myApp', []);
    function compare(a, b) {
        if (a.time < b.time) {
            return -1;
        }
        if (a.time > b.time) {
            return 1;
        }
        return 0;
    }

    app.controller('myCtrl', function($scope, $http) {
        $scope.app_name = "Android Demo";
        //var eventsDb = window.MyUsage.GetAllEvent();
        //events = JSON.parse(events);
        //events = JSON.stringify(events, null, 4);
        //$scope.events = events;
        days = {};
        for (var key in eventsDb) {
            var time = new Date(parseInt(key));
            var date = time.toDateString() // toDateString() 自带时区
            var second = time.getSeconds() + 60*(time.getMinutes() + 60*time.getHours());
            if (days[date] == null) {
                days[date] = [];
            }
            days[date].push({
                time: second,
                type: eventsDb[key],
            });
        }
        var daySec = 24*60*60;
        for (var key in days) {
            var events = days[key];
            events.sort(compare);
            days[key] = []
            for (var i in events) {
                if (events[i].type == KEYGUARD_SHOWN) {
                    days[key].push({
                        left: events[i].time/daySec*100,
                        witdh: 1,
                    })
                }
                if (days[key].length > 0 && events[i].type == KEYGUARD_HIDDEN) {
                    div = days[key].at(-1);
                    div.witdh = (events[i].time - div.left)/daySec*100;
                }
            }
        }
        $scope.days = Object.entries(days);
    });
</script>
</body>
</html>